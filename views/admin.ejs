<%- include('header') %>

<div class="admin-container">
    <h1 class="admin-title">Admin Dashboard</h1>

    <% if (typeof errorMessage !== 'undefined') { %>
        <p class="error-message"><%= errorMessage %></p>
    <% } %>

    <% if (typeof successMessage !== 'undefined') { %>
        <p class="success-message"><%= successMessage %></p>
    <% } %>

    <table class="user-table">
        <thead>
        <tr>
            <th>Username</th>
            <th>Is Admin</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <% users.forEach(user => { %>
            <tr>
                <td><%= user.username %></td>
                <td><%= user.isAdmin ? 'Yes' : 'No' %></td>
                <td>
                    <form action="/admin/update/<%= user._id %>" method="POST" class="update-form">
                        <label for="newUsername-<%= user._id %>">New Username:</label>
                        <input type="text" id="newUsername-<%= user._id %>" name="newUsername" value="<%= user.username %>" required>

                        <label for="password-<%= user._id %>">New Password:</label>
                        <input type="password" id="password-<%= user._id %>" name="password">

                        <label for="isAdmin-<%= user._id %>">Is Admin:</label>
                        <input type="checkbox" id="isAdmin-<%= user._id %>" name="isAdmin" <% if (user.isAdmin) { %>checked<% } %>>

                        <button class="update-button" type="submit">Update</button>
                    </form>

                    <form action="/admin/delete/<%= user._id %>" method="POST" class="delete-form">
                        <button class="delete-button" type="submit">Delete</button>
                    </form>
                </td>
            </tr>
        <% }) %>
        </tbody>
    </table>

    <h2>Create New User</h2>
    <form action="/admin/create" method="POST" class="create-form">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br>

        <label for="password">Password:</label>
        <input type="password" class="password" name="password" required><br>

        <label for="password2">Confirm Password:</label>
        <input type="password" class="password" name="password2" required><br>

        <label for="isAdminCreate">Is Admin:</label>
        <input type="checkbox" id="isAdminCreate" name="isAdmin"><br>

        <button class="create-button" type="submit">Create User</button>
    </form>


    <h2>Existing Banners</h2>
    <% banners.forEach(banner => { %>
        <div>
            <p>Title: <%= banner.title %></p>
            <p>Type: <%= banner.type %></p>
            <p>Items: <%= banner.items.join(', ') %></p>
            <button class="edit-button" onclick="document.getElementById('editForm<%= banner._id %>').style.display='block'">Edit</button>
            <div id="editForm<%= banner._id %>" class="editForm" style="display:none;">
                <form action="/admin/update-banner/<%= banner._id %>" method="POST">
                    <label for="title">Title:</label>
                    <input type="text" id="title" name="title" value="<%= banner.title %>" required><br>

                    <label for="type">Type:</label>
                    <select id="type" name="type">
                        <option value="anime" <% if (banner.type === 'anime') { %> selected <% } %>>Anime</option>
                        <option value="manga" <% if (banner.type === 'manga') { %> selected <% } %>>Manga</option>
                    </select><br>

                    <label for="items">Items (comma separated):</label>
                    <input type="text" id="items" name="items" value="<%= banner.items.join(', ') %>" required><br>

                    <button type="submit">Update Banner</button>
                </form>
            </div>

            <form action="/admin/delete-banner/<%= banner._id %>" method="POST" style="display:inline;">
                <button type="submit">Delete</button>
            </form>
        </div>
    <% }); %>


    <h2>Create Banner</h2>
    <form action="/admin/create-banner" method="post">
        <label for="title">Banner Title:</label>
        <input type="text" id="title" name="title" required><br>

        <label for="type">Select Type:</label>
        <select id="type" name="type">
            <option value="anime">Anime</option>
            <option value="manga">Manga</option>
        </select><br>

        <label for="items">Item IDs (comma separated):</label>
        <input type="text" id="items" name="items" required><br>

        <button type="submit">Create Banner</button>
    </form>
</div>


<%- include('footer') %>
